---
categories: developers
title: Running Tests
---
{% include toc.md %}

## Setup

### Fedora 20

```console
$ yum install python-nose python-pip rhnlib
$ sudo pip install mock freezegun
```

### RHEL 6

```console
$ yum install python-pip rhnlib
$ sudo pip install nose mock freezegun
```

## Running Tests

It is helpful to configure nose to assign numeric IDs to each test making it easier to run specific tests.

```properties
[nosetests]
with-id=True
```

In your global ~/.gitignore place
```
.noseids
```

This configures nose to run every time with --with-id.  [docs](https://nose.readthedocs.org/en/latest/plugins/testid.html)


Jump in to your subscription-manager check-out and run `nosetest`.  The tests will run.  However, if you are in an SSH session, then some of the GTK tests will fail.  Make sure that you have the DISPLAY environment variable set: `export DISPLAY=:0.0`.  Or you can use [Xvfb](http://en.wikipedia.org/wiki/Xvfb) and never have to worry about the problem again.  See the nose-xvfb section below.

### Running Specific Tests

Nose is really great at letting you zero in on just what you want to run.

  * Run the tests that failed last run

    ```console
    $ nosetests --failed
    ```
    Remember that "with-id" option we added?  It's what makes --failed work smoothly.
  * Want to run just one module?  Just provide the path to that module.  You can also use the Python dotted notation (test.my_test), but using the path lets you use tab completion in your shell

    ```console
    $ nosetests test/my_test.py
    ```
  * How about a single class?

    ```console
    $ nosetests test/my_test.py:TestClass
    ```
  * And now let's get really specific and run just one test

    ```console
    # nosetests test/my_test.py:TestClass.test_method
    ```

    Of course, who wants to type all those long method names?  So, you can use the IDs generated by --with-id.  Print all the IDs with the `-v` option.  Then use the numbers for additional runs.

    ```console
    $ nosetests -v tests/my_test.py
    #1 test_blah (test.my_test.TestClass) ... ok
    #2 test_blah2 (test.my_test.TestClass) ... ok
    $ nosetests 1 2
    ```

## Plugins

Nose has a lot of plugins.  Some are [built-in](https://nose.readthedocs.org/en/latest/plugins/builtin.html) and others are [third-party](http://nose-plugins.jottit.com/).  Here are some that I find really useful.

### nose-xvfb (Third-party)

This plugin is essential for us in my opinion.  It lets you run all the tests with out using your own X server, so you don't get a bunch of dialogs popping up or failures because you don't have DISPLAY set.  Unfortunately, the plugin isn't in PyPI and has some dependencies so you have to do a little more of work.  The xorg-x11-server-Xvfb is available with no problem in Fedora.  In RHEL 6, things are a little weird because the package was moved to a new channel: RHEL Server Optional.  You can grab the package from there.

```console
$ yum install xorg-x11-server-Xvfb
$ git clone git://github.com/awood/nose-xvfb
$ pip install ./nose-xvfb/
$ nosetests --with-xvfb
```

And since this option is so useful, I put it in my `.noserc` like so:

```properties
[nosetests]
with-xvfb=True
with-id=True
```

### Capture
By default, Nose captures all the output to stdout.  If your test fails, then it will show the output, otherwise it goes in the trash.  If you want to see the output anyway, use `-s`.

### YANC (Third-party)

Let's add a little color to our tests.

```console
$ pip install yanc
```

Now you can use the --with-yanc option to get color results for your test.  I find this so useful, that I just set it as `with-yanc=True` in `.noserc`.

### [nose-progressive](https://pypi.python.org/pypi/nose-progressive/) (Third-party)

Normally Nose prints out a period for each successful test and an E or and F for errors and failures.  That's pretty nice, but if you're short on space, you can use nose-progressive which consolidates all the output into a progress bar.  Error information is printed prettily and printed in such a way that you can open your editor right to the line you need (Make sure you have $EDITOR set to what you want).  This plugin works in tmux too.

```console
$ pip install nose-progressive
$ nosetests --with-progressive
```

### Pdb

This plugin drops into pdb whenever there is a test with errors or failures.  Just use `--pdb` and `--pdb-failures`.


